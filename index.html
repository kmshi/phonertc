<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="PhoneRTC : WebRTC for Cordova apps" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>PhoneRTC</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/alongubkin/phonertc">View on GitHub</a>

          <h1 id="project_title">PhoneRTC</h1>
          <h2 id="project_tagline">WebRTC for Cordova apps</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/alongubkin/phonertc/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/alongubkin/phonertc/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="phonertc" class="anchor" href="#phonertc"><span class="octicon octicon-link"></span></a>PhoneRTC</h2>

<p>WebRTC for Cordova apps!</p>

<p><strong>Note:</strong> PhoneRTC is still at very early stages. Right now, it's more like a proof-of-concept than a production-ready library. </p>

<h3>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h3>

<ul>
<li>Completely open source</li>
<li>Android and iOS support</li>
<li>Simple JavaScript API</li>
<li>Video &amp; Voice chat</li>
<li>Use your own servers without relying on any third-parties</li>
<li>Perfect for hybrid mobile apps using Angular</li>
</ul><h3>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h3>

<ul>
<li>TURN server - <a href="https://code.google.com/p/rfc5766-turn-server/">rfc5766-turn-server</a> on Amazon EC2 is a good option here</li>
<li>Signaling server - <a href="http://signalr.net/">SignalR</a> if you are using ASP.NET or <a href="http://socket.io/">socket.io</a> if you are using Node.js are recommended</li>
</ul><h3>
<a name="upcoming-features" class="anchor" href="#upcoming-features"><span class="octicon octicon-link"></span></a>Upcoming features</h3>

<ul>
<li>Group chat</li>
<li>API documentation</li>
<li>Volume control</li>
</ul><h3>
<a name="how-does-phonertc-differ-from-opentok-weemo-etc" class="anchor" href="#how-does-phonertc-differ-from-opentok-weemo-etc"><span class="octicon octicon-link"></span></a>How does PhoneRTC differ from OpenTok, Weemo, etc?</h3>

<p>WebRTC is a peer-to-peer protocol, but it still needs some servers: a signaling server for initializing the call and a proxy server if the peer-to-peer connection fails.</p>

<p>Other solutions, such as OpenTok and Weemo, require you to use their own third-party servers. That means they are much easier to use, but that also means that they are less open, have a subscription model, and you are generally less in control.</p>

<p>PhoneRTC allows you to use your own servers, without relying on any third-parties.</p>

<h3>
<a name="setting-up-a-turn-server" class="anchor" href="#setting-up-a-turn-server"><span class="octicon octicon-link"></span></a>Setting up a TURN server</h3>

<p>To set up a TURN server, create an Amazon EC2 instance with the latest Ubuntu. Open the following ports in the instance security group:</p>

<pre><code>TCP 443
TCP 3478-3479
TCP 32355-65535
UDP 3478-3479
UDP 32355-65535
</code></pre>

<p>Open SSH and run:</p>

<pre><code>sudo apt-get install rfc5766-turn-server
</code></pre>

<p>Next, edit <code>/etc/turnserver.conf</code> and change the following options:</p>

<pre><code>listening-ip=&lt;private EC2 ip address&gt;
relay-ip=&lt;private EC2 ip address&gt;
external-ip=&lt;public EC2 ip address&gt;
min-port=32355 
max-port=65535
realm=&lt;your domain&gt;
</code></pre>

<p>Also uncomment the following options:</p>

<pre><code>lt-cred-mech
fingerprint 
</code></pre>

<p>Next, open <code>/etc/turnuserdb.conf</code> and add a new user at the end of the file. The format is: </p>

<pre><code>username:password
</code></pre>

<p>To start the TURN server, run the following command:</p>

<pre><code>sudo /etc/init.d/rfc5766-turn-server start
</code></pre>

<h3>
<a name="plugin-installation" class="anchor" href="#plugin-installation"><span class="octicon octicon-link"></span></a>Plugin Installation</h3>

<p>Install Cordova:</p>

<pre><code>npm install -g cordova ios-deploy
</code></pre>

<p>Create a new Cordova project:</p>

<pre><code>cordova create &lt;name&gt;
cordova platform add ios android
</code></pre>

<p>Add the plugin:</p>

<pre><code>cordova plugin add https://github.com/alongubkin/phonertc.git
</code></pre>

<h3>
<a name="usage-example" class="anchor" href="#usage-example"><span class="octicon octicon-link"></span></a>Usage Example</h3>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">phonertc</span> <span class="o">=</span> <span class="nx">cordova</span><span class="p">.</span><span class="nx">require</span><span class="p">(</span><span class="s1">'com.dooble.phonertc.PhoneRTC'</span><span class="p">);</span>

<span class="nx">phonertc</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span> 
    <span class="nx">isInitator</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// Caller or callee?</span>
    <span class="nx">turn</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">host</span><span class="o">:</span> <span class="s1">'turn:turn.example.com:3478'</span><span class="p">,</span>
        <span class="nx">username</span><span class="o">:</span> <span class="s1">'user'</span><span class="p">,</span>
        <span class="nx">password</span><span class="o">:</span> <span class="s1">'pass'</span>
    <span class="p">},</span>
    <span class="nx">sendMessageCallback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// PhoneRTC wants to send a message to your target, use</span>
        <span class="c1">// your signaling server here to send the message.</span>
        <span class="nx">signaling</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="p">{</span> 
            <span class="nx">type</span><span class="o">:</span> <span class="s1">'webrtc_handshake'</span><span class="p">,</span>
            <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">answerCallback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">'Callee answered!'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">disconnectCallback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">'Call disconnected!'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">video</span><span class="o">:</span> <span class="p">{</span>  <span class="c1">// Remove this property if you don't want video chat</span>
        <span class="nx">localVideo</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'localVideo'</span><span class="p">),</span>
        <span class="nx">remoteVideo</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'remoteVideo'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">signaling</span><span class="p">.</span><span class="nx">onMessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'webrtc_handshake'</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// when a message is received from the signaling server, </span>
        <span class="c1">// notify the PhoneRTC plugin.</span>
        <span class="nx">phonertc</span><span class="p">.</span><span class="nx">receiveMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>

<h3>
<a name="building" class="anchor" href="#building"><span class="octicon octicon-link"></span></a>Building</h3>

<p>Building for Android is easy. You can just:</p>

<pre><code>cordova build android
cordova run android
</code></pre>

<p>In iOS, it's slightly more complicated. Run the following code. It will prepare all of the web code to be deployed to your device. It must be re-run every time you change any web code:</p>

<pre><code>cordova prepare ios
</code></pre>

<p>Open the project in Xcode and change the following options in the project settings (these must be changed for both your project and the CordovaLib project):</p>

<pre><code>Valid Architectures =&gt; armv7
Build Active Architecture Only =&gt; No
</code></pre>

<p>In the target choose a real iOS device, not the simulator, otherwise it won't build. You should now be able to run this on your device.</p>

<p>To create an IPA, go to Product &gt; Archive.</p>

<h3>
<a name="note-on-native-libraries" class="anchor" href="#note-on-native-libraries"><span class="octicon octicon-link"></span></a>Note on native libraries</h3>

<p>The <code>libs</code> directory contains compiled libraries from the <a href="https://code.google.com/p/webrtc/">official WebRTC project</a>. If you want to build them yourself, use the following tutorials:</p>

<p>Android: <a href="https://code.google.com/p/webrtc/source/browse/trunk/talk/examples/android/README">https://code.google.com/p/webrtc/source/browse/trunk/talk/examples/android/README</a></p>

<p>iOS: <a href="https://code.google.com/p/webrtc/source/browse/trunk/talk/app/webrtc/objc/README">https://code.google.com/p/webrtc/source/browse/trunk/talk/app/webrtc/objc/README</a></p>

<h3>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h3>

<p>iOS Video Support: <a href="https://github.com/egreenmachine">@egreenmachine</a> (BitCoin Donations: <code>12pDZFVov6rDPjhGTz9Xj4qqegdoCJF3Ea</code>)</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">PhoneRTC maintained by <a href="https://github.com/alongubkin">alongubkin</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
